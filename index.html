<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable = no"" />

<title>伪艺术家纽约行</title>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet"
	href="/FakeArtist/css/bootstrap.min.css">
<script
	src="//ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular.min.js"></script>
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>
<script
	src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
</head>
<body ng-app="myApp" ng-controller="gamesCtrl">
	<div class="container">
		<h3 id="header">
			伪艺术家纽约行
			<button class="btn btn-primary btn-sm" style="float: right"
				data-toggle="modal" data-target="#ruleModal">
				<span class="glyphicon glyphicon-question-sign"></span>游戏规则
			</button>
			<button class="btn btn-primary btn-sm" style="float: right"
				data-toggle="modal" data-target="#createGameModal">
				<span class="glyphicon glyphicon-repeat"></span>开始新游戏
			</button>
		</h3>
		<hr>
		<div class="btn-group " data-toggle="buttons">
			<label class="btn btn-default"
			       ng-repeat="color in colors"
			       ng-class="{active: {{color}}=={{currentColor}}}"
			       ng-click="setGhostNum(color)"
				style="color:{{color}}">
				<input type="radio" ng-model="newGame.ghostNum" value="{{color}}">
				&#x2588;
			</label>
		</div>
		<hr>
		<svg id="sketch" style="cursor:default;height:calc(100vh - 180px);width:100%;border: 1px solid;background-color:white;">
		</svg>
		<!-- Modal -->
		<div class="modal fade" id="createGameModal" tabindex="-1"
			role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"
			data-backdrop="static">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal"
							aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
						<h4 class="modal-title" id="myModalLabel">创建游戏</h4>
					</div>
					<div class="modal-body">
						<p>
							<label for="ghostNum" class="col-md-2 control-label">鬼数量</label>
						</p>
						<p>
						<div class="btn-group " data-toggle="buttons">
							<label class="btn btn-default btn-sm"
								ng-repeat="i in [] | range:5"
								ng-class="{active: {{i+1}}==newGame.ghostNum}"
								ng-click="setGhostNum(i+1)"> <input type="radio"
								ng-model="newGame.ghostNum" value="{{i+1}}"> {{i+1}}
							</label>
						</div>
						</p>
						<p>
							<label for="humanNum" class="col-md-2 control-label">人类数量</label>
						</p>
						<p>
						<div class="btn-group " data-toggle="buttons">
							<label class="btn btn-default btn-sm"
								ng-repeat="i in [] | range:10"
								ng-class="{active: {{i+1}}==newGame.humanNum}"
								ng-click="setHumanNum(i+1)"> <input type="radio"
								ng-model="newGame.humanNum" id="{{i+1}}" value="{{i+1}}">
								{{i+1}}
							</label>
						</div>
						</p>
						<p>
							<label for="foolNum" class="col-md-2 control-label">傻瓜数量</label>
						</p>
						<p>
						<div class="btn-group " data-toggle="buttons">
							<label class="btn btn-default btn-sm"
								ng-class="{active: {{i+1}}==newGame.foolNum}"
								ng-repeat="i in [] | range:5" ng-click="setFoolNum(i+1)">
								<input type="radio" name="foolNum" ng-model="newGame.foolNum"
								id="{{i+1}}" value="{{i+1}}"> {{i+1}}
							</label>
						</div>
						</p>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default btn-xs"
							data-dismiss="modal">取消</button>
						<button type="button" class="btn btn-primary btn-xs"
							ng-click="gameNumSet()">下一步</button>
					</div>
				</div>
			</div>
		</div>
		<!-- Modal -->
		<div class="modal fade" id="setInfoModal" tabindex="-1" role="dialog"
			aria-labelledby="myModalLabel" aria-hidden="true"
			data-backdrop="static">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal"
							aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
						<h4 class="modal-title" id="myModalLabel">输入信息</h4>
					</div>
					<div class="modal-body">
						<p>
							<label>鬼的信息：</label> <input type="text"
								ng-model="newGame.ghostInfo">
						</p>
						<p>
							<label>人的信息：</label> <input type="text"
								ng-model="newGame.humanInfo">
						</p>
						<p>
							<label>傻瓜的信息：</label>
						</p>
						<p ng-repeat="i in [] | range:newGame.foolNum">
							<label>傻瓜{{i+1}}</label> <input type="text"
								ng-model="newGame.foolInfo[i]">
						</p>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default btn-xs"
							ng-click="back2NumSet()">上一步</button>
						<button type="button" class="btn btn-primary btn-xs"
							ng-click="createGame()">创建游戏</button>
					</div>
				</div>
			</div>
		</div>
		<!-- Modal -->
		<div class="modal fade" id="ruleModal" tabindex="-1" role="dialog"
			aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h4 class="modal-title" id="myModalLabel">游戏规则</h4>
					</div>
					<div class="modal-body">
						<div>
							<ol>
								<li>开始新游戏后，艺术家依次选定颜色并获得类别及提示词，然后把平板递给下一个玩家。伪艺术家只能看到类别。真艺术家获得的提示词一致。</li>
								<li>所有艺术家选定颜色并获得提示词后，依颜色顺序开始作画，每次仅能画一笔，然后递给下个玩家。</li>
								<li>每个艺术家各绘制2笔后，绘画结束。</li>
								<li>所有艺术家投票选出伪艺术家。</li>
								<li>若伪艺术家未被认出（未被最多人指认），则可与出题人共同获得2分。但若伪艺术家被认出，则该伪艺术家有一次猜题机会。若能猜对所绘内容，则可与出题者共同获得2分。否则，其他艺术家可各获得一分。</li>
							</ol>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default btn-xs"
							data-dismiss="modal">我知道了</button>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script>
		var app = angular.module('myApp', []);
		app.controller('gamesCtrl', function($scope, $http, $interval) {
			$scope.newGame = new Object();
			$scope.currentColor='red';
			$scope.colors= ['white','sliver','gray','black','red','maroon','yellow','olive','lime','green','aqua','teal','blue','navy','fuchsia','purple']						    

			$scope.changeNick = function() {
				if ($scope.newNick == '') {
					$('#nickEmptyAlert').show();
				} else {
					$scope.nick = $scope.newNick;
					localStorage.nick = $scope.nick;
					$('#editNickModal').modal('hide');
				}
			}

			$scope.gameNumSet = function() {
				$('#createGameModal').modal('hide');
				$('#setInfoModal').modal('show');
			}

			$scope.newGame.foolInfo = new Array();
			$scope.newGame.foolInfo[0] = '';
			$scope.newGame.foolInfo[1] = '';
			$scope.newGame.foolInfo[2] = '';
			$scope.newGame.foolInfo[3] = '';
			$scope.newGame.foolInfo[4] = '';
			if (localStorage.game) {
				$scope.game = localStorage.game;
			} else {
			}
			if ($scope.game) {
				$('#createGameModal').modal('show');
			}
			if (localStorage.humanNum) {
				$scope.newGame.humanNum = localStorage.humanNum;
			} else {
				$scope.newGame.humanNum = 3;
				localStorage.humanNum = 3;
			}
			if (localStorage.ghostNum) {
				$scope.newGame.ghostNum = localStorage.ghostNum;
			} else {
				$scope.newGame.ghostNum = 3;
				localStorage.ghostNum = 3;
			}
			if (localStorage.foolNum) {
				$scope.newGame.foolNum = localStorage.foolNum;
			} else {
				$scope.newGame.foolNum = 2;
				localStorage.foolNum = 2;
			}

				$scope.setHumanNum = function(i) {
				$scope.newGame.humanNum = i;
				localStorage.humanNum = i;

			}
			$scope.setGhostNum = function(i) {
				$scope.newGame.ghostNum = i;
				localStorage.ghostNum = i;
			}
			$scope.setFoolNum = function(i) {
				$scope.newGame.foolNum = i;
				localStorage.foolNum = i;
			}
			$scope.newGame.foolInfo = [ "", "", "", "", "" ];
			$scope.newGame.humanInfo = "";
			$scope.newGame.ghostInfo = "";
			
			$http.get("/FakeArtist/list.json").success(function(response) {
				$scope.randomList = response.randomList;
			});
		});

		app.filter('range', function() {
			return function(input, total) {
				total = parseInt(total);
				for ( var i = 0; i < total; i++)
					input.push(i);
				return input;
			};
		});
	</script>
</body>
</html>

